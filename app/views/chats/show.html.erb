<h1>Discussion</h1>

<div class="chat-box" id="chat-box" style="border: 1px solid #ccc; padding: 1rem; max-height: 400px; overflow-y: auto;">
  <% @messages.each do |message| %>
    <div style="margin-bottom: 0.5rem;">
      <strong><%= message.user.nom.presence || message.user.email %></strong> :
      <%= message.content %>
      <small style="color: grey;"><%= message.created_at.strftime("%H:%M") %></small>
    </div>
  <% end %>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const chatBox = document.getElementById("chat-box");
    chatBox.scrollTop = chatBox.scrollHeight;
  });
</script>

<%= form_with model: [@exchange, @chat, @message], local: true do |form| %>
  <div class="field">
    <%= form.text_area :content, rows: 2, placeholder: "Ã‰cris ton message..." %>
  </div>
  <div class="actions">
    <%= form.submit "Envoyer", class: "btn btn-primary" %>
  </div>
<% end %>
